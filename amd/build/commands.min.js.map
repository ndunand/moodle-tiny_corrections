{"version":3,"file":"commands.min.js","sources":["../src/commands.js"],"sourcesContent":["import {get_string as getString} from 'core/str';\nimport {component} from './common';\nimport {getCorrTypes} from \"./options\";\n\n/**\n * Add a correction on the current selection.\n * @param {editor} editor\n * @returns {void}\n */\nfunction addCorrection(editor) {\n    let correction_types = getCorrTypes(editor);\n    correction_types = correction_types.replace(/\\n$/, '');\n\n    let correction_types_array = correction_types.split('\\n').map((line) => {\n        let [value, text] = line.split('=');\n        return {text: text, value: value};\n    });\n\n    editor.windowManager.open({\n        title: 'Add a correction',\n        body: {\n            type: 'panel',\n            items: [\n                {\n                    type: 'selectbox',\n                    name: 'correction_type',\n                    label: 'Correction type',\n                    items: correction_types_array\n                },\n                {\n                    type: 'textarea',\n                    name: 'correction_comment',\n                    label: 'Comment'\n                }\n            ]\n        },\n        buttons: [\n            {\n                type: 'submit',\n                text: 'OK'\n            }\n        ],\n        initialData: {\n            correction_type: 'none',\n            correction_comment: '',\n        },\n        onSubmit: (api) => {\n            const data = api.getData();\n            const correction_type = data.correction_type;\n            const correction_comment = data.correction_comment;\n\n            let whole_content = editor.getContent({format: 'html'});\n            let current_selection = editor.selection.getContent({});\n            let updated_selection =\n                `<span class=\"tiny_corrections\">\n                    ${current_selection}\n                    <span class=\"tiny_corrections_correction\">\n                        <sup title=\"${current_selection}\">${correction_type}</sup>\n                        <span class=\"tiny_corrections_comment\">${correction_comment}</span>\n                    </span>\n                </span>`;\n            let updated_content = whole_content.replace(current_selection, updated_selection);\n            editor.setContent(updated_content);\n            api.close();\n        }\n    });\n}\n\n/**\n * Remove the correction on the current selection or cursor position\n * @param {editor} editor\n */\nfunction removeCorrection(editor) {\n    let selection = editor.selection.getNode();\n    if (selection.classList.contains('tiny_corrections')) {\n        selection.querySelector('.tiny_corrections_correction').remove();\n        selection.attributes.removeNamedItem('class');\n    }\n\n}\n\nexport const getSetup = async () => {\n    const [\n        addCorrectionButtonTitle,\n        removeCorrectionButtonTitle\n    ] = await Promise.all([\n        getString('button_addcorrection', component),\n        getString('button_removecorrection', component),\n    ]);\n\n    return (editor) => {\n        editor.contentCSS.push(window.M.cfg.wwwroot + '/lib/editor/tiny/plugins/corrections/styles.css');\n\n        editor.ui.registry.addButton('add_correction', {\n            icon: 'comment-add',\n            tooltip: addCorrectionButtonTitle,\n            onAction: () => addCorrection(editor)\n        });\n\n        editor.ui.registry.addButton('remove_correction', {\n            icon: 'comment',\n            tooltip: removeCorrectionButtonTitle,\n            onAction: () => removeCorrection(editor)\n        });\n    };\n};"],"names":["async","addCorrectionButtonTitle","removeCorrectionButtonTitle","Promise","all","component","editor","contentCSS","push","window","M","cfg","wwwroot","ui","registry","addButton","icon","tooltip","onAction","correction_types","replace","correction_types_array","split","map","line","value","text","windowManager","open","title","body","type","items","name","label","buttons","initialData","correction_type","correction_comment","onSubmit","api","data","getData","whole_content","getContent","format","current_selection","selection","updated_selection","updated_content","setContent","close","addCorrection","getNode","classList","contains","querySelector","remove","attributes","removeNamedItem","removeCorrection"],"mappings":"8NAiFwBA,gBAEhBC,yBACAC,mCACMC,QAAQC,IAAI,EAClB,mBAAU,uBAAwBC,oBAClC,mBAAU,0BAA2BA,4BAGjCC,SACJA,OAAOC,WAAWC,KAAKC,OAAOC,EAAEC,IAAIC,QAAU,mDAE9CN,OAAOO,GAAGC,SAASC,UAAU,iBAAkB,CAC3CC,KAAM,cACNC,QAAShB,yBACTiB,SAAU,aAvFCZ,YACfa,kBAAmB,yBAAab,QACpCa,iBAAmBA,iBAAiBC,QAAQ,MAAO,QAE/CC,uBAAyBF,iBAAiBG,MAAM,MAAMC,KAAKC,WACtDC,MAAOC,MAAQF,KAAKF,MAAM,WACxB,CAACI,KAAMA,KAAMD,MAAOA,UAG/BnB,OAAOqB,cAAcC,KAAK,CACtBC,MAAO,mBACPC,KAAM,CACFC,KAAM,QACNC,MAAO,CACH,CACID,KAAM,YACNE,KAAM,kBACNC,MAAO,kBACPF,MAAOX,wBAEX,CACIU,KAAM,WACNE,KAAM,qBACNC,MAAO,aAInBC,QAAS,CACL,CACIJ,KAAM,SACNL,KAAM,OAGdU,YAAa,CACTC,gBAAiB,OACjBC,mBAAoB,IAExBC,SAAWC,YACDC,KAAOD,IAAIE,UACXL,gBAAkBI,KAAKJ,gBACvBC,mBAAqBG,KAAKH,uBAE5BK,cAAgBrC,OAAOsC,WAAW,CAACC,OAAQ,SAC3CC,kBAAoBxC,OAAOyC,UAAUH,WAAW,IAChDI,iFAEMF,mIAEgBA,+BAAsBT,kGACKC,oFAGjDW,gBAAkBN,cAAcvB,QAAQ0B,kBAAmBE,mBAC/D1C,OAAO4C,WAAWD,iBAClBT,IAAIW,WAiCYC,CAAc9C,UAGlCA,OAAOO,GAAGC,SAASC,UAAU,oBAAqB,CAC9CC,KAAM,UACNC,QAASf,4BACTgB,SAAU,aA9BIZ,YAClByC,UAAYzC,OAAOyC,UAAUM,UAC7BN,UAAUO,UAAUC,SAAS,sBAC7BR,UAAUS,cAAc,gCAAgCC,SACxDV,UAAUW,WAAWC,gBAAgB,UA0BjBC,CAAiBtD"}