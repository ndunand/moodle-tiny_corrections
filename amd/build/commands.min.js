define("tiny_corrections/commands",["exports","core/str","./common","./options"],(function(_exports,_str,_common,_options){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.getSetup=void 0;_exports.getSetup=async()=>{const[addCorrectionButtonTitle,removeCorrectionButtonTitle]=await Promise.all([(0,_str.get_string)("button_addcorrection",_common.component),(0,_str.get_string)("button_removecorrection",_common.component)]);let addIcon=await fetch(window.M.cfg.wwwroot+"/lib/editor/tiny/plugins/corrections/pix/add.svg").then((response=>response.text())),removeIcon=await fetch(window.M.cfg.wwwroot+"/lib/editor/tiny/plugins/corrections/pix/remove.svg").then((response=>response.text()));return editor=>{editor.ui.registry.addIcon("commentAdd",addIcon),editor.ui.registry.addIcon("commentRemove",removeIcon),editor.contentCSS.push(window.M.cfg.wwwroot+"/lib/editor/tiny/plugins/corrections/styles.css"),editor.ui.registry.addButton("add_correction",{icon:"commentAdd",tooltip:addCorrectionButtonTitle,onAction:()=>async function(editor){const[addCorrectionButtonTitle,correctionTypeTitle,commentTitle]=await Promise.all([(0,_str.get_string)("button_addcorrection",_common.component),(0,_str.get_string)("corrtype",_common.component),(0,_str.get_string)("corrtext",_common.component)]);let correction_types_array=function(editor){let correction_types=(0,_options.getCorrTypes)(editor);return correction_types=correction_types.replace(/\n$/,""),correction_types.split("\n").map((line=>{let[value,text]=line.split("=");return{text:text,value:value}}))}(editor);editor.windowManager.open({title:addCorrectionButtonTitle,body:{type:"panel",items:[{type:"selectbox",name:"correction_type",label:correctionTypeTitle,items:correction_types_array},{type:"textarea",name:"correction_comment",label:commentTitle}]},buttons:[{type:"submit",text:"OK"}],initialData:{correction_type:"none",correction_comment:""},onSubmit:api=>{!function(data,editor){const correction_type=data.correction_type,correction_comment=data.correction_comment;let current_selection=editor.selection.getContent({}),updated_selection='<span class="tiny_corrections">\n                    '.concat(current_selection,'\n                    <span class="tiny_corrections_correction">\n                        <sup title="').concat(current_selection,'">').concat(correction_type,'</sup>\n                        <span class="tiny_corrections_comment">').concat(correction_comment,"</span>\n                    </span>\n                </span>");editor.selection.setContent(updated_selection)}(api.getData(),editor),api.close()}})}(editor)}),editor.ui.registry.addButton("remove_correction",{icon:"commentRemove",tooltip:removeCorrectionButtonTitle,onAction:()=>function(editor){let selection=editor.selection.getNode();selection.classList.contains("tiny_corrections")&&(selection.querySelector(".tiny_corrections_correction").remove(),selection.attributes.removeNamedItem("class"))}(editor)})}}}));

//# sourceMappingURL=commands.min.js.map